---
const { card } = Astro.props;

const media = card?.media ?? [];
const hasMedia = media.length > 0;
const isCarousel = media.length > 1;

// ✅ 카드별로 라벨 바꾸고 싶으면 notionLabel을 카드에 추가해서 쓰는 게 안전함
const notionLabel = card?.notionLabel ?? "상세 정보(Notion)";
---

<article class="fc">
    <header class="fc__header">
        <div>
            <h3 class="fc__title">{card.title}</h3>
            <p class="fc__summary">{card.summary}</p>
        </div>
    </header>

    {hasMedia ? (
            <div class="fc__mediaWrap" data-carousel={isCarousel ? "true" : "false"}>
                {isCarousel ? (
                        <>
                            <div class="fc__viewport" data-viewport>
                                {media.map((m) => (
                                        <div class="fc__slide" data-slide>
                                            {m.type === "video" ? (
                                                    <video
                                                            class="fc__mediaEl"
                                                            src={m.src}
                                                            controls
                                                            preload="metadata"
                                                            poster={m.poster || undefined}
                                                    />
                                            ) : (
                                                    <img class="fc__mediaEl" src={m.src} alt={m.alt || ""} loading="lazy" />
                                            )}
                                        </div>
                                ))}
                            </div>

                            <button class="fc__nav fc__prev" type="button" data-prev aria-label="이전">‹</button>
                            <button class="fc__nav fc__next" type="button" data-next aria-label="다음">›</button>

                            <div class="fc__dots">
                                {media.map((_, i) => (
                                        <button class="fc__dot" type="button" data-dot data-index={i} aria-label={`${i + 1}`} />
                                ))}
                            </div>

                            <script is:inline>
                                {/* 너가 작성한 캐러셀 스크립트 그대로 두면 됨 */}
                            </script>
                        </>
                ) : (
                        <div class="fc__single">
                            {media[0].type === "video" ? (
                                    <video
                                            class="fc__mediaEl"
                                            src={media[0].src}
                                            controls
                                            preload="metadata"
                                            poster={media[0].poster || undefined}
                                    />
                            ) : (
                                    <img class="fc__mediaEl" src={media[0].src} alt={media[0].alt || ""} loading="lazy" />
                            )}
                        </div>
                )}
            </div>
    ) : null}

    {(card?.points?.length || card?.notionHref || card?.links?.length) ? (
            <div class="fc__details">
                {card?.points?.length ? (
                        <>
                            <div class="fc__detailsTitle">핵심 포인트</div>
                            <ul class="fc__list">
                                {card.points.map((p) => <li>{p}</li>)}
                            </ul>
                        </>
                ) : null}

                {card.notionHref ? (
                        <a class="chip" href={card.notionHref} target="_blank" rel="noreferrer">
                            {notionLabel}
                        </a>
                ) : null}

                {card.links?.map((l) => (
                        <a class="chip" href={l.href} target="_blank" rel="noreferrer" data-kind={l.kind}>
                            {l.label}
                        </a>
                ))}
            </div>
    ) : null}
</article>
